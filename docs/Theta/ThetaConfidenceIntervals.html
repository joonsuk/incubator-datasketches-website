<!DOCTYPE html>
<!-- Start _layouts/doc_page.html-->
<html lang="en">

<head>
  <!-- Start site_head.html include-->
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="datasketches">

<title>DataSketches | </title>

<link rel="shortcut icon" href="/img/favicon.png">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

<link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700,300italic|Open+Sans:300italic,400italic,600italic,400,300,600'
  rel='stylesheet' type='text/css'>

<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/header.css">
<link rel="stylesheet" href="/css/footer.css">
<link rel="stylesheet" href="/css/syntax.css">
<link rel="stylesheet" href="/css/docs.css">


<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full">
</script>
<script src="https://code.jquery.com/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<!-- End site_head.html include-->

</head>

<body>
  <!-- Start page_header.html include -->
<div class="navbar navbar-inverse navbar-static-top ds-nav">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <!-- navbar-brand: https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css -->
      <!-- /css/main.css:57:.logo -->
      <a class="navbar-brand logo" href="/">DataSketches</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/overview.html">
            <span class="fa fa-info-circle"></span> OVERVIEW</a>
        </li>
        <li>
          <a href="/docs/downloads.html">
            <span class="fa fa-download"></span> DOWNLOAD</a>
        </li>
        <li>
          <a href="https://datasketches.github.io/README.html">
            <span class="fa fa-github"></span> GITHUB</a>
        </li>
        <li>
          <a href="/docs/Research.html">
            <span class="fa fa-paper-plane"></span> RESEARCH</a>
        </li>
        <li>
          <a href="https://groups.google.com/forum/#!forum/sketches-user">
            <span class="fa fa-comment"></span> FORUM</a>
        </li>

      </ul>
    </div>
  </div>
</div>
<!-- End page_header.html include -->


  <div class="ds-header">
    <div class="container">
      <h4>API Snapshots:
        <a href="/api/java/snapshot/apidocs/index.html">Java Core</a>,
        <a href="/api/memory/snapshot/apidocs/index.html">Memory</a>,
        <a href="/api/pig/snapshot/apidocs/index.html">Pig</a>,
        <a href="/api/hive/snapshot/apidocs/index.html">Hive</a>,
      </h4>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <div class="searchbox" style="position:relative">
          <gcse:searchbox-only></gcse:searchbox-only>
        </div>
        <!-- Computer Generated File, Do Not Edit! -->
<link rel="stylesheet" href="/css/toc.css">
<div id="toc" class="nav toc hidden-print">

  <p id="overview">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_overview">Overview</a>
  </p>
  <div class="collapse" id="collapse_overview">
    <li><a href="/docs/TheChallenge.html">The Challenge</a></li>
    <li><a href="/docs/MajorSketchFamilies.html">The Major Sketch Families</a></li>
    <li><a href="/docs/SketchOrigins.html">Sketch Origins</a></li>
    <li><a href="/docs/SketchElements.html">Sketch Elements</a></li>
    <li><a href="/docs/KeyFeatures.html">Key Features</a></li>
    <li><a href="/docs/LargeScale.html">Large Scale Computing</a></li>
    <li><a href="/docs/Architecture.html">Architecture</a></li>
    <li><a href="/docs/OrderSensitivity.html">Notes on Order Sensitivity</a></li>
    <li><a href="/docs/Concurrency.html">Notes on Concurrency</a></li>
    <li><a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/DataSketches_deck.pdf">Overview Slide Deck</a></li>
  </div>

  <p id="research">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_research">Research</a>
  </p>
  <div class="collapse" id="collapse_research">
    <li><a href="/docs/Research.html">Research</a></li>
  </div>

  <p id="distinct-counting">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_distinct_counting">Distinct Counting</a>
  </p>
  <div class="collapse" id="collapse_distinct_counting">

    <p id="hyperloglog-sketches">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_hyperloglog_sketches">HyperLogLog Sketches</a>
    </p>
    <div class="collapse" id="collapse_hyperloglog_sketches">
      <li><a href="/docs/HLL/HLL.html">HLL Sketch</a></li>
      <li><a href="/docs/HLL/HllMap.html">HLL Map Sketch</a></li>

      <p id="hll-examples">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_hll_examples">HLL Examples</a>
      </p>
      <div class="collapse" id="collapse_hll_examples">
        <li><a href="/docs/HLL/HllJavaExample.html">HLL Sketch Java Example</a></li>
        <li><a href="/docs/HLL/HllPigUDFs.html">HLL Sketch Pig UDFs</a></li>
        <li><a href="/docs/HLL/HllHiveUDFs.html">HLL Sketch Hive UDFs</a></li>
        <li><a href="/docs/DruidIntegration.html">Using Sketches in Druid</a></li>
      </div>

      <p id="hll-studies">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_hll_studies">HLL Studies</a>
      </p>
      <div class="collapse" id="collapse_hll_studies">
        <li><a href="/docs/HLL/Hll_vs_Hllpp.html">HLL vs HLL++</a></li>
        <li><a href="/docs/HLL/HllSketchVsDruidHyperLogLogCollector.html">HLL Sketch vs Druid HyperLogLogCollector</a></li>
      </div>
    </div>

    <p id="theta-sketches">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_theta_sketches">Theta Sketches</a>
    </p>
    <div class="collapse" id="collapse_theta_sketches">
      <li><a href="/docs/Theta/ThetaSketchFramework.html">Theta Sketch Framework</a></li>

      <p id="theta-examples">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_theta_examples">Theta Examples</a>
      </p>
      <div class="collapse" id="collapse_theta_examples">
        <li><a href="/docs/Theta/ConcurrentThetaSketch.html">Concurrent Theta Sketch</a></li>
        <li><a href="/docs/Theta/ThetaJavaExample.html">Theta Sketch Java Example</a></li>
        <li><a href="/docs/Theta/ThetaSparkExample.html">Theta Sketch Spark Example</a></li>
        <li><a href="/docs/Theta/ThetaPigUDFs.html">Theta Sketch Pig UDFs</a></li>
        <li><a href="/docs/Theta/ThetaHiveUDFs.html">Theta Sketch Hive UDFs</a></li>
        <li><a href="/docs/DruidIntegration.html">Using Sketches in Druid</a></li>
      </div>

      <p id="kmv-tutorial">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_kmv_tutorial">KMV Tutorial</a>
      </p>
      <div class="collapse" id="collapse_kmv_tutorial">
        <li><a href="/docs/Theta/InverseEstimate.html">The Inverse Estimate</a></li>
        <li><a href="/docs/Theta/KMVempty.html">Empty Sketch</a></li>
        <li><a href="/docs/Theta/KMVfirstEst.html">First Estimator</a></li>
        <li><a href="/docs/Theta/KMVbetterEst.html">Better Estimator</a></li>
        <li><a href="/docs/Theta/KMVrejection.html">Rejection Rules</a></li>
        <li><a href="/docs/Theta/KMVupdateVkth.html">Update V(kth) Rule</a></li>
      </div>

      <p id="set-operations-and-p-sampling">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_set_operations_and_p-sampling">Set Operations and P-sampling</a>
      </p>
      <div class="collapse" id="collapse_set_operations_and_p-sampling">
        <li><a href="/docs/Theta/ThetaSketchSetOps.html">Set Operations</a></li>
        <li><a href="/docs/Theta/ThetaPSampling.html"><i>p</i>-Sampling</a></li>
      </div>

      <p id="accuracy">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_accuracy">Accuracy</a>
      </p>
      <div class="collapse" id="collapse_accuracy">
        <li><a href="/docs/Theta/ThetaAccuracy.html">Basic Accuracy</a></li>
        <li><a href="/docs/Theta/ThetaAccuracyPlots.html">Accuracy Plots</a></li>
        <li><a href="/docs/Theta/ThetaErrorTable.html">Relative Error Table</a></li>
        <li><a href="/docs/Theta/ThetaSketchSetOpsAccuracy.html">SetOp Accuracy</a></li>
        <li><a href="/docs/Theta/AccuracyOfDifferentKUnions.html">Unions With Different k</a></li>
      </div>

      <p id="size">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_size">Size</a>
      </p>
      <div class="collapse" id="collapse_size">
        <li><a href="/docs/Theta/ThetaSize.html">Theta Sketch Size</a></li>
      </div>

      <p id="speed">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_speed">Speed</a>
      </p>
      <div class="collapse" id="collapse_speed">
        <li><a href="/docs/Theta/ThetaUpdateSpeed.html">Update Speed</a></li>
        <li><a href="/docs/Theta/ThetaMergeSpeed.html">Merge Speed</a></li>
      </div>

      <p id="theta-sketch-theory">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_theta_sketch_theory">Theta Sketch Theory</a>
      </p>
      <div class="collapse" id="collapse_theta_sketch_theory">
        <li><a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/ThetaSketchFramework.pdf">Theta Sketch Framework (PDF)</a></li>
        <li><a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/SketchEquations.pdf">Sketch Equations (PDF)</a></li>
        <li><a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/DataSketches.pdf">DataSketches (PDF)</a></li>
        <li><a href="/docs/Theta/ThetaConfidenceIntervals.html">Confidence Intervals Notes</a></li>
        <li><a href="/docs/Theta/ThetaMergingAlgorithm.html">Merging Algorithm Notes</a></li>
        <li><a href="/docs/Theta/ThetaReferences.html">Theta References</a></li>
      </div>
    </div>

    <p id="tuple-sketches">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_tuple_sketches">Tuple Sketches</a>
    </p>
    <div class="collapse" id="collapse_tuple_sketches">
      <li><a href="/docs/Tuple/TupleOverview.html">Tuple Overview</a></li>

      <p id="tuple-examples">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_tuple_examples">Tuple Examples</a>
      </p>
      <div class="collapse" id="collapse_tuple_examples">
        <li><a href="/docs/Tuple/TupleJavaExample.html">Tuple Java Example</a></li>
        <li><a href="/docs/Tuple/TupleEngagementExample.html">Tuple Engagement Example</a></li>
        <li><a href="/docs/Frequency/FrequentDistinctTuplesSketch.html">Frequent Distinct Tuples Sketch</a></li>
        <li><a href="/docs/Tuple/TuplePigUDFs.html">Tuple Pig UDFs</a></li>
        <li><a href="/docs/Tuple/TupleHiveUDFs.html">Tuple Hive UDFs</a></li>
        <li><a href="/docs/DruidIntegration.html">Using Sketches in Druid</a></li>
      </div>
    </div>
  </div>

  <p id="most-frequent">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_most_frequent">Most Frequent</a>
  </p>
  <div class="collapse" id="collapse_most_frequent">
    <li><a href="/docs/Frequency/FrequencySketchesOverview.html">Frequency Sketches Overview</a></li>

    <p id="frequent-item-sketches">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_frequent_item_sketches">Frequent Item Sketches</a>
    </p>
    <div class="collapse" id="collapse_frequent_item_sketches">
      <li><a href="/docs/Frequency/FrequentItemsOverview.html">Frequent Items Overview</a></li>
      <li><a href="/docs/Frequency/FrequentItemsErrorTable.html">Frequent Items Error Table</a></li>
      <li><a href="/docs/Frequency/FrequentItemsReferences.html">Frequent Items References</a></li>

      <p id="most-frequent-examples">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_most_frequent_examples">Most Frequent Examples</a>
      </p>
      <div class="collapse" id="collapse_most_frequent_examples">
        <li><a href="/docs/Frequency/FrequentItemsJavaExample.html">Frequent Items Java Example</a></li>
        <li><a href="/docs/Frequency/FrequentItemsPigUDFs.html">Frequent Items Pig UDFs</a></li>
        <li><a href="/docs/Frequency/FrequentItemsHiveUDFs.html">Frequent Items Hive UDFs</a></li>
        <li><a href="/docs/DruidIntegration.html">Using Sketches in Druid</a></li>
      </div>
    </div>

    <p id="frequent-distinct-sketches">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_frequent_distinct_sketches">Frequent Distinct Sketches</a>
    </p>
    <div class="collapse" id="collapse_frequent_distinct_sketches">
      <li><a href="/docs/Frequency/FrequentDistinctTuplesSketch.html">Frequent Distinct Tuples Sketch</a></li>
    </div>
  </div>

  <p id="quantiles-and-histograms">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_quantiles_and_histograms">Quantiles And Histograms</a>
  </p>
  <div class="collapse" id="collapse_quantiles_and_histograms">
    <li><a href="/docs/Quantiles/QuantilesOverview.html">Quantiles Overview</a></li>
    <li><a href="/docs/Quantiles/QuantilesAccuracy.html">Quantiles Accuracy and Size</a></li>

    <p id="quantiles-examples">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_quantiles_examples">Quantiles Examples</a>
    </p>
    <div class="collapse" id="collapse_quantiles_examples">
      <li><a href="/docs/Quantiles/QuantilesJavaExample.html">Quantiles Sketch Java Example</a></li>
      <li><a href="/docs/Quantiles/QuantilesPigUDFs.html">Quantiles Sketch Pig UDFs</a></li>
      <li><a href="/docs/Quantiles/QuantilesHiveUDFs.html">Quantiles Sketch Hive UDFs</a></li>
      <li><a href="/docs/DruidIntegration.html">Using Sketches in Druid</a></li>
    </div>

    <p id="quantiles-studies">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_quantiles_studies">Quantiles Studies</a>
    </p>
    <div class="collapse" id="collapse_quantiles_studies">
      <li><a href="/docs/Quantiles/KLLSketch.html">New KLL sketch and comparison with DoublesSketch</a></li>
      <li><a href="/docs/Quantiles/KllSketchVsTDigest.html">KLL sketch vs t-digest</a></li>
      <li><a href="/docs/Quantiles/DruidApproxHistogramStudy.html">Druid Approximate Histogram</a></li>
      <li><a href="/docs/Quantiles/MomentsSketchStudy.html">Moments Sketch Study</a></li>
      <li><a href="/docs/Quantiles/QuantilesStreamAStudy.html">Quantiles StreamA Study</a></li>
    </div>

    <p id="quantiles-sketch-theory">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_quantiles_sketch_theory">Quantiles Sketch Theory</a>
    </p>
    <div class="collapse" id="collapse_quantiles_sketch_theory">
      <li><a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/Quantiles_KLL.pdf">Optimal Quantile Approximation in Streams</a></li>
      <li><a href="/docs/Quantiles/QuantilesReferences.html">Quantiles References</a></li>
    </div>
  </div>

  <p id="sampling">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_sampling">Sampling</a>
  </p>
  <div class="collapse" id="collapse_sampling">
    <li><a href="/docs/Sampling/ReservoirSampling.html">Reservoir Sampling</a></li>
    <li><a href="/docs/Sampling/ReservoirSamplingPerformance.html">Reservoir Sampling Performance</a></li>
    <li><a href="/docs/Sampling/VarOptSampling.html">VarOpt Sampling</a></li>

    <p id="sampling-examples">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_sampling_examples">Sampling Examples</a>
    </p>
    <div class="collapse" id="collapse_sampling_examples">
      <li><a href="/docs/Sampling/ReservoirSamplingJava.html">Reservoir Sampling Java Example</a></li>
      <li><a href="/docs/Sampling/ReservoirSamplingPigUDFs.html">Reservoir Sampling Pig UDFs</a></li>
      <li><a href="/docs/Sampling/VarOptSamplingJava.html">VarOpt Sampling Java Example</a></li>
      <li><a href="/docs/Sampling/VarOptPigUDFs.html">VarOpt Sampling Pig UDFs</a></li>
    </div>
  </div>

  <p id="memory-package">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_memory_package">Memory Package</a>
  </p>
  <div class="collapse" id="collapse_memory_package">
    <li><a href="/docs/Memory/MemoryPackage.html">Memory Package</a></li>
    <li><a href="/docs/Memory/MemoryPerformance.html">Memory Package Performance</a></li>
  </div>

  <p id="command-line">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_command_line">Command Line</a>
  </p>
  <div class="collapse" id="collapse_command_line">
    <li><a href="/docs/CommandLine/CommandLine.html">Creating Command Line Executables</a></li>
  </div>

  <p id="who-uses">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_who_uses">Who Uses</a>
  </p>
  <div class="collapse" id="collapse_who_uses">
    <li><a href="/docs/WhoUses.html">Who Uses</a></li>
  </div>
</div>
<script>
  (function () {

    var findLineItem = function (path) {
      return document.querySelector(`[href="${path}"]`);
    };

    var highlighLineItem = function (element) {
      element.classList.add('highlight');
    };

    var checkHasClass = function (element, className) {
      return element.className.split(' ').find(function (item) { return item === className || '' })
    }

    var findAllCollapseParents = function (element) {
      var collapseMenus = [];
      var elementPointer = element;
      while (elementPointer !== document.body) {
        if (checkHasClass(elementPointer, 'collapse')) {
          collapseMenus.push(elementPointer);
        }
        elementPointer = elementPointer.parentElement
      }
      return collapseMenus
    };

    var findMatchingCollapseMenu = function (collapseItem) {
      return document.querySelector(`[href="#${collapseItem.id}"]`);
    };

    var findAllParentMenus = function (element) {
      var parentMenus = []
      var elementPointer = element;
      while (elementPointer !== document.body) {
        if (elementPointer.className.split(' ').indexOf('menu') > -1) {
          parentMenus.push(elementPointer);
        }
        elementPointer = elementPointer.parentElement;
      }
      return parentMenus;
    }

    var openMenuItem = function (element) {
      element.click();
    };

    var openAllFromList = function (elementList) {
      elementList.forEach(function (element) {
        console.log(element)
        openMenuItem(findMatchingCollapseMenu(element))
      });
    };

    var highlightAndOpenMenu = function () {
      var currentLineItem = findLineItem(document.location.pathname);
      highlighLineItem(currentLineItem)
      openAllFromList(findAllCollapseParents(currentLineItem));
    };

    $(highlightAndOpenMenu);

  }());
</script>


      </div>
      <div class="col-md-9 doc-content">
        <a class="btn btn-default btn-xs visible-xs-inline-block visible-sm-inline-block" href="/docs/toc.html">Table of Contents</a>
        <!--
    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->

<h3>Theta Sketch Confidence Intervals, Notes</h3>
<ol>
  <li>
    <p>The Theta Sketches within the DataSketches Library provide Frequentist Confidence Intervals 
based on the tails of the Binomial Distribution.</p>
  </li>
  <li>
    <p>These bounds are only approximate, but we provide a guarantee
(backed by experiments, not by proofs) that neither bound is off
by more than 1 percent of the estimate.</p>
  </li>
  <li>
    <p>To avoid numerical issues and high computational cost, the implementation
carves up the input space (|S|, p) into multiple regions, and uses
different approximations on each.</p>
  </li>
  <li>
    <p>At a high level, there is a two-way split, between large |S|, and small |S|.
When |S| &gt; 120, the continuity-corrected Gaussian approximation to the Binomial
Distribution satisfies the 1 percent guarantee, so we just use that.</p>
  </li>
  <li>
    <p>For small |S| &lt;= 120, the main idea is to fall back to the exact Binomial
Distribution. However, that is expensive, and worse yet, subject to
numerical issues. These issues are serious, and occur when p is very 
close to 1.0 or 0.0.  Therefore we immediately split off two more cases.</p>
  </li>
  <li>
    <p>When p is very close to 1.0, we already know (because |S| is small)
that the answer is [|S|-1, |S|+1], so we just return that instead
of trying to evaluate the incomplete beta function with difficult inputs.</p>
  </li>
  <li>
    <p>When p is very close to 0.0 (say 1e-6), one could avoid the numerical issues by 
exploiting the fact that the LB and the UB are very close to being
constant multiples of the estimate. The exact multiples would depend on 
|S|, and delta, but could be pre-computed and stored in tables.</p>
  </li>
  <li>
    <p>It turns that a slightly fancier version of the idea (7) allows a 
satisfactory (i.e. 1 percent) approximation to the bounds to be 
obtained not only for small p, but also for moderate p [but not for large p].
This version of the idea uses the continuity-corrected Gaussian approximation
to the Binomial Distribution, but with an “adjusted” number of standard 
deviations, that is different for the LB and for the UB, and for each value 
of |S| and of delta. However, these adjusted numbers can be precomputed
and stored in a table. This is what the library does.</p>
  </li>
  <li>
    <p>We have now carved away enough cases so that we only need to compute
exact bounds for 0 &lt;= |S| &lt;= 120, for p values that are large (although
not super-close to 1.0).</p>
  </li>
  <li>
    <p>The switchover between scheme (8) and scheme (9) is determined by a threshold
on p which depends on the value of |S|. The library’s specific threshold |S|/360
was empirically chosen to support the promise of 1 percent accuracy.</p>

    <ol>
      <li>
        <p>The exact bounds needed by scheme (9) could be computed using
 binary search on the tails of the Binomial Distribution, with the
 latter computed using a high-quality implementation of the
 Incomplete Beta Function obtained from a Scientific Computing
 library.</p>
      </li>
      <li>
        <p>We have written and heavily used some auxiliary code
 which does exactly that: binary search using the Incomplete Beta
 Function. It was used to pre-compute the tables mentioned in
 point (7); to choose values for the various empirically determined
 thresholds such as 120 and |S|/360; and finally in an extensive grid
 search covering the input parameter space to verify that our overall 
 approximation scheme satisfies the 1 percent accuracy guarantee.</p>
      </li>
      <li>
        <p>However, it was impractical for the Theta Sketch Library as such to include
 a high quality implementation of the Incomplete Beta Function; writing one
 is a task best left to experts, and we didn’t want the Theta Sketch Library
 to have an external dependence on a Scientific library.</p>
      </li>
      <li>
        <p>Therefore we developed a more direct approach the computing the exact LB and UB.
 It is based on an interesting combinatorial identity and exploits the facts
 that p &gt;= |S|/360 and |S| &lt;= 120. It employs a simple linear search,
 so there is no tricky bracketing and binary search code, and it takes at 
 most 30 microseconds to compute [the slowest input is |S|=1, p = 1/360].</p>
      </li>
    </ol>
  </li>
  <li>
    <p>We mention that UB=LB=|S| when p=1, and LB=0 when |S|=0. Also, the library
uses a closed-form expression for the UB when |S|=0, and for the LB when |S|=1.</p>
  </li>
  <li>
    <p>So far, we have been discussing the Frequentist Confidence Interval based on the
tails of the Binomial Distribution. In some cases (for example when p is very close
to 1.0) the LB can be smaller than |S|. However, it is obvious that n &gt;= |S|, so the
library returns |S| instead of the official Binomial LB in that case.</p>
  </li>
  <li>
    <p>In addition, just in case it is possible (we are not sure) for the
library to compute a confidence interval that doesn’t cover the
estimate, we shield the user from these hypothetical outputs by
by always checking and if necessary growing the interval to cover
the estimate.</p>
  </li>
</ol>

<p>Also see the <a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/ThetaSketchFramework.pdf">Theta Sketch Framework</a> paper.</p>

      </div>
    </div>
  </div>

  <!-- Start page_footer.html include -->
<footer class="ds-footer">
  <div class="container">
    <div class="text-center">
      <p>
        <a href="/overview.html">
          <span class="fa fa-info-circle"></span> Overview</a>&ensp;·&ensp;
        <a href="/docs/downloads.html">
          <span class="fa fa-download"></span> Download</a>&ensp;·&ensp;
        <a href="https://github.com/apache?utf8=%E2%9C%93&q=datasketches">
          <span class="fa fa-github"></span> GitHub</a>&ensp;·&ensp;
        <a href="https://groups.google.com/forum/#!forum/sketches-user">
          <span class="fa fa-comment"></span> Comments</a>&ensp;·&ensp;
        <a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/LICENSE">Licensing</a>
      </p>
    </div>
  </div>
</footer>
<!-- End page_footer.html include -->

</body>

</html>
<!-- End _layouts/doc_page.html-->
