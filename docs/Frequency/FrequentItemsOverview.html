<!DOCTYPE html>
<!-- Start _layouts/doc_page.html-->
<html lang="en">

<head>
  <!-- Start site_head.html include-->
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="datasketches">

<title>DataSketches | </title>

<link rel="shortcut icon" href="/img/favicon.png">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

<link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700,300italic|Open+Sans:300italic,400italic,600italic,400,300,600'
  rel='stylesheet' type='text/css'>

<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/header.css">
<link rel="stylesheet" href="/css/footer.css">
<link rel="stylesheet" href="/css/syntax.css">
<link rel="stylesheet" href="/css/docs.css">


<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full">
</script>
<script src="https://code.jquery.com/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<!-- End site_head.html include-->

</head>

<body>
  <!-- Start page_header.html include -->
<div class="navbar navbar-inverse navbar-static-top ds-nav">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <!-- navbar-brand: https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css -->
      <!-- /css/main.css:57:.logo -->
      <a class="navbar-brand logo" href="/">DataSketches</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/overview.html">
            <span class="fa fa-info-circle"></span> OVERVIEW</a>
        </li>
        <li>
          <a href="/docs/downloads.html">
            <span class="fa fa-download"></span> DOWNLOAD</a>
        </li>
        <li>
          <a href="https://github.com/apache?utf8=%E2%9C%93&q=datasketches&type=&language=">
            <span class="fa fa-github"></span> GITHUB</a>
        </li>
        <li>
          <a href="/docs/Research.html">
            <span class="fa fa-paper-plane"></span> RESEARCH</a>
        </li>
        <li>
          <a href="https://groups.google.com/forum/#!forum/sketches-user">
            <span class="fa fa-comment"></span> FORUM</a>
        </li>

      </ul>
    </div>
  </div>
</div>
<!-- End page_header.html include -->


  <div class="ds-header">
    <div class="container">
      <h4>API Snapshots:
        <a href="/api/java/snapshot/apidocs/index.html">Java Core</a>,
        <a href="/api/memory/snapshot/apidocs/index.html">Memory</a>,
        <a href="/api/pig/snapshot/apidocs/index.html">Pig</a>,
        <a href="/api/hive/snapshot/apidocs/index.html">Hive</a>,
      </h4>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <div class="searchbox" style="position:relative">
          <gcse:searchbox-only></gcse:searchbox-only>
        </div>
        <!-- Computer Generated File, Do Not Edit! -->
<link rel="stylesheet" href="/css/toc.css">
<div id="toc" class="nav toc hidden-print">

  <p id="overview">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_overview">Overview</a>
  </p>
  <div class="collapse" id="collapse_overview">
    <li><a href="/docs/TheChallenge.html">The Challenge</a></li>
    <li><a href="/docs/MajorSketchFamilies.html">The Major Sketch Families</a></li>
    <li><a href="/docs/SketchOrigins.html">Sketch Origins</a></li>
    <li><a href="/docs/SketchElements.html">Sketch Elements</a></li>
    <li><a href="/docs/KeyFeatures.html">Key Features</a></li>
    <li><a href="/docs/LargeScale.html">Large Scale Computing</a></li>
    <li><a href="/docs/Architecture.html">Architecture</a></li>
    <li><a href="/docs/OrderSensitivity.html">Notes on Order Sensitivity</a></li>
    <li><a href="/docs/Concurrency.html">Notes on Concurrency</a></li>
    <li><a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/DataSketches_deck.pdf">Overview Slide Deck</a></li>
  </div>

  <p id="research">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_research">Research</a>
  </p>
  <div class="collapse" id="collapse_research">
    <li><a href="/docs/Research.html">Research</a></li>
  </div>

  <p id="distinct-counting">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_distinct_counting">Distinct Counting</a>
  </p>
  <div class="collapse" id="collapse_distinct_counting">

    <p id="hyperloglog-sketches">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_hyperloglog_sketches">HyperLogLog Sketches</a>
    </p>
    <div class="collapse" id="collapse_hyperloglog_sketches">
      <li><a href="/docs/HLL/HLL.html">HLL Sketch</a></li>
      <li><a href="/docs/HLL/HllMap.html">HLL Map Sketch</a></li>

      <p id="hll-examples">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_hll_examples">HLL Examples</a>
      </p>
      <div class="collapse" id="collapse_hll_examples">
        <li><a href="/docs/HLL/HllJavaExample.html">HLL Sketch Java Example</a></li>
        <li><a href="/docs/HLL/HllPigUDFs.html">HLL Sketch Pig UDFs</a></li>
        <li><a href="/docs/HLL/HllHiveUDFs.html">HLL Sketch Hive UDFs</a></li>
        <li><a href="/docs/DruidIntegration.html">Using Sketches in Druid</a></li>
      </div>

      <p id="hll-studies">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_hll_studies">HLL Studies</a>
      </p>
      <div class="collapse" id="collapse_hll_studies">
        <li><a href="/docs/HLL/Hll_vs_Hllpp.html">HLL vs HLL++</a></li>
        <li><a href="/docs/HLL/HllSketchVsDruidHyperLogLogCollector.html">HLL Sketch vs Druid HyperLogLogCollector</a></li>
      </div>
    </div>

    <p id="theta-sketches">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_theta_sketches">Theta Sketches</a>
    </p>
    <div class="collapse" id="collapse_theta_sketches">
      <li><a href="/docs/Theta/ThetaSketchFramework.html">Theta Sketch Framework</a></li>

      <p id="theta-examples">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_theta_examples">Theta Examples</a>
      </p>
      <div class="collapse" id="collapse_theta_examples">
        <li><a href="/docs/Theta/ConcurrentThetaSketch.html">Concurrent Theta Sketch</a></li>
        <li><a href="/docs/Theta/ThetaJavaExample.html">Theta Sketch Java Example</a></li>
        <li><a href="/docs/Theta/ThetaSparkExample.html">Theta Sketch Spark Example</a></li>
        <li><a href="/docs/Theta/ThetaPigUDFs.html">Theta Sketch Pig UDFs</a></li>
        <li><a href="/docs/Theta/ThetaHiveUDFs.html">Theta Sketch Hive UDFs</a></li>
        <li><a href="/docs/DruidIntegration.html">Using Sketches in Druid</a></li>
      </div>

      <p id="kmv-tutorial">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_kmv_tutorial">KMV Tutorial</a>
      </p>
      <div class="collapse" id="collapse_kmv_tutorial">
        <li><a href="/docs/Theta/InverseEstimate.html">The Inverse Estimate</a></li>
        <li><a href="/docs/Theta/KMVempty.html">Empty Sketch</a></li>
        <li><a href="/docs/Theta/KMVfirstEst.html">First Estimator</a></li>
        <li><a href="/docs/Theta/KMVbetterEst.html">Better Estimator</a></li>
        <li><a href="/docs/Theta/KMVrejection.html">Rejection Rules</a></li>
        <li><a href="/docs/Theta/KMVupdateVkth.html">Update V(kth) Rule</a></li>
      </div>

      <p id="set-operations-and-p-sampling">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_set_operations_and_p-sampling">Set Operations and P-sampling</a>
      </p>
      <div class="collapse" id="collapse_set_operations_and_p-sampling">
        <li><a href="/docs/Theta/ThetaSketchSetOps.html">Set Operations</a></li>
        <li><a href="/docs/Theta/ThetaPSampling.html"><i>p</i>-Sampling</a></li>
      </div>

      <p id="accuracy">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_accuracy">Accuracy</a>
      </p>
      <div class="collapse" id="collapse_accuracy">
        <li><a href="/docs/Theta/ThetaAccuracy.html">Basic Accuracy</a></li>
        <li><a href="/docs/Theta/ThetaAccuracyPlots.html">Accuracy Plots</a></li>
        <li><a href="/docs/Theta/ThetaErrorTable.html">Relative Error Table</a></li>
        <li><a href="/docs/Theta/ThetaSketchSetOpsAccuracy.html">SetOp Accuracy</a></li>
        <li><a href="/docs/Theta/AccuracyOfDifferentKUnions.html">Unions With Different k</a></li>
      </div>

      <p id="size">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_size">Size</a>
      </p>
      <div class="collapse" id="collapse_size">
        <li><a href="/docs/Theta/ThetaSize.html">Theta Sketch Size</a></li>
      </div>

      <p id="speed">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_speed">Speed</a>
      </p>
      <div class="collapse" id="collapse_speed">
        <li><a href="/docs/Theta/ThetaUpdateSpeed.html">Update Speed</a></li>
        <li><a href="/docs/Theta/ThetaMergeSpeed.html">Merge Speed</a></li>
      </div>

      <p id="theta-sketch-theory">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_theta_sketch_theory">Theta Sketch Theory</a>
      </p>
      <div class="collapse" id="collapse_theta_sketch_theory">
        <li><a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/ThetaSketchFramework.pdf">Theta Sketch Framework (PDF)</a></li>
        <li><a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/SketchEquations.pdf">Sketch Equations (PDF)</a></li>
        <li><a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/DataSketches.pdf">DataSketches (PDF)</a></li>
        <li><a href="/docs/Theta/ThetaConfidenceIntervals.html">Confidence Intervals Notes</a></li>
        <li><a href="/docs/Theta/ThetaMergingAlgorithm.html">Merging Algorithm Notes</a></li>
        <li><a href="/docs/Theta/ThetaReferences.html">Theta References</a></li>
      </div>
    </div>

    <p id="tuple-sketches">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_tuple_sketches">Tuple Sketches</a>
    </p>
    <div class="collapse" id="collapse_tuple_sketches">
      <li><a href="/docs/Tuple/TupleOverview.html">Tuple Overview</a></li>

      <p id="tuple-examples">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_tuple_examples">Tuple Examples</a>
      </p>
      <div class="collapse" id="collapse_tuple_examples">
        <li><a href="/docs/Tuple/TupleJavaExample.html">Tuple Java Example</a></li>
        <li><a href="/docs/Tuple/TupleEngagementExample.html">Tuple Engagement Example</a></li>
        <li><a href="/docs/Frequency/FrequentDistinctTuplesSketch.html">Frequent Distinct Tuples Sketch</a></li>
        <li><a href="/docs/Tuple/TuplePigUDFs.html">Tuple Pig UDFs</a></li>
        <li><a href="/docs/Tuple/TupleHiveUDFs.html">Tuple Hive UDFs</a></li>
        <li><a href="/docs/DruidIntegration.html">Using Sketches in Druid</a></li>
      </div>
    </div>
  </div>

  <p id="most-frequent">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_most_frequent">Most Frequent</a>
  </p>
  <div class="collapse" id="collapse_most_frequent">
    <li><a href="/docs/Frequency/FrequencySketchesOverview.html">Frequency Sketches Overview</a></li>

    <p id="frequent-item-sketches">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_frequent_item_sketches">Frequent Item Sketches</a>
    </p>
    <div class="collapse" id="collapse_frequent_item_sketches">
      <li><a href="/docs/Frequency/FrequentItemsOverview.html">Frequent Items Overview</a></li>
      <li><a href="/docs/Frequency/FrequentItemsErrorTable.html">Frequent Items Error Table</a></li>
      <li><a href="/docs/Frequency/FrequentItemsReferences.html">Frequent Items References</a></li>

      <p id="most-frequent-examples">
        <a data-toggle="collapse" class="menu collapsed" href="#collapse_most_frequent_examples">Most Frequent Examples</a>
      </p>
      <div class="collapse" id="collapse_most_frequent_examples">
        <li><a href="/docs/Frequency/FrequentItemsJavaExample.html">Frequent Items Java Example</a></li>
        <li><a href="/docs/Frequency/FrequentItemsPigUDFs.html">Frequent Items Pig UDFs</a></li>
        <li><a href="/docs/Frequency/FrequentItemsHiveUDFs.html">Frequent Items Hive UDFs</a></li>
        <li><a href="/docs/DruidIntegration.html">Using Sketches in Druid</a></li>
      </div>
    </div>

    <p id="frequent-distinct-sketches">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_frequent_distinct_sketches">Frequent Distinct Sketches</a>
    </p>
    <div class="collapse" id="collapse_frequent_distinct_sketches">
      <li><a href="/docs/Frequency/FrequentDistinctTuplesSketch.html">Frequent Distinct Tuples Sketch</a></li>
    </div>
  </div>

  <p id="quantiles-and-histograms">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_quantiles_and_histograms">Quantiles And Histograms</a>
  </p>
  <div class="collapse" id="collapse_quantiles_and_histograms">
    <li><a href="/docs/Quantiles/QuantilesOverview.html">Quantiles Overview</a></li>
    <li><a href="/docs/Quantiles/QuantilesAccuracy.html">Quantiles Accuracy and Size</a></li>

    <p id="quantiles-examples">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_quantiles_examples">Quantiles Examples</a>
    </p>
    <div class="collapse" id="collapse_quantiles_examples">
      <li><a href="/docs/Quantiles/QuantilesJavaExample.html">Quantiles Sketch Java Example</a></li>
      <li><a href="/docs/Quantiles/QuantilesPigUDFs.html">Quantiles Sketch Pig UDFs</a></li>
      <li><a href="/docs/Quantiles/QuantilesHiveUDFs.html">Quantiles Sketch Hive UDFs</a></li>
      <li><a href="/docs/DruidIntegration.html">Using Sketches in Druid</a></li>
    </div>

    <p id="quantiles-studies">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_quantiles_studies">Quantiles Studies</a>
    </p>
    <div class="collapse" id="collapse_quantiles_studies">
      <li><a href="/docs/Quantiles/KLLSketch.html">New KLL sketch and comparison with DoublesSketch</a></li>
      <li><a href="/docs/Quantiles/KllSketchVsTDigest.html">KLL sketch vs t-digest</a></li>
      <li><a href="/docs/Quantiles/DruidApproxHistogramStudy.html">Druid Approximate Histogram</a></li>
      <li><a href="/docs/Quantiles/MomentsSketchStudy.html">Moments Sketch Study</a></li>
      <li><a href="/docs/Quantiles/QuantilesStreamAStudy.html">Quantiles StreamA Study</a></li>
    </div>

    <p id="quantiles-sketch-theory">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_quantiles_sketch_theory">Quantiles Sketch Theory</a>
    </p>
    <div class="collapse" id="collapse_quantiles_sketch_theory">
      <li><a href="https://github.com/DataSketches/DataSketches.github.io/blob/master/docs/pdf/Quantiles_KLL.pdf">Optimal Quantile Approximation in Streams</a></li>
      <li><a href="/docs/Quantiles/QuantilesReferences.html">Quantiles References</a></li>
    </div>
  </div>

  <p id="sampling">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_sampling">Sampling</a>
  </p>
  <div class="collapse" id="collapse_sampling">
    <li><a href="/docs/Sampling/ReservoirSampling.html">Reservoir Sampling</a></li>
    <li><a href="/docs/Sampling/ReservoirSamplingPerformance.html">Reservoir Sampling Performance</a></li>
    <li><a href="/docs/Sampling/VarOptSampling.html">VarOpt Sampling</a></li>

    <p id="sampling-examples">
      <a data-toggle="collapse" class="menu collapsed" href="#collapse_sampling_examples">Sampling Examples</a>
    </p>
    <div class="collapse" id="collapse_sampling_examples">
      <li><a href="/docs/Sampling/ReservoirSamplingJava.html">Reservoir Sampling Java Example</a></li>
      <li><a href="/docs/Sampling/ReservoirSamplingPigUDFs.html">Reservoir Sampling Pig UDFs</a></li>
      <li><a href="/docs/Sampling/VarOptSamplingJava.html">VarOpt Sampling Java Example</a></li>
      <li><a href="/docs/Sampling/VarOptPigUDFs.html">VarOpt Sampling Pig UDFs</a></li>
    </div>
  </div>

  <p id="memory-package">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_memory_package">Memory Package</a>
  </p>
  <div class="collapse" id="collapse_memory_package">
    <li><a href="/docs/Memory/MemoryPackage.html">Memory Package</a></li>
    <li><a href="/docs/Memory/MemoryPerformance.html">Memory Package Performance</a></li>
  </div>

  <p id="command-line">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_command_line">Command Line</a>
  </p>
  <div class="collapse" id="collapse_command_line">
    <li><a href="/docs/CommandLine/CommandLine.html">Creating Command Line Executables</a></li>
  </div>

  <p id="who-uses">
    <a data-toggle="collapse" class="menu collapsed" href="#collapse_who_uses">Who Uses</a>
  </p>
  <div class="collapse" id="collapse_who_uses">
    <li><a href="/docs/WhoUses.html">Who Uses</a></li>
  </div>
</div>
<script>
  (function () {

    var findLineItem = function (path) {
      return document.querySelector(`[href="${path}"]`);
    };

    var highlighLineItem = function (element) {
      element.classList.add('highlight');
    };

    var checkHasClass = function (element, className) {
      return element.className.split(' ').find(function (item) { return item === className || '' })
    }

    var findAllCollapseParents = function (element) {
      var collapseMenus = [];
      var elementPointer = element;
      while (elementPointer !== document.body) {
        if (checkHasClass(elementPointer, 'collapse')) {
          collapseMenus.push(elementPointer);
        }
        elementPointer = elementPointer.parentElement
      }
      return collapseMenus
    };

    var findMatchingCollapseMenu = function (collapseItem) {
      return document.querySelector(`[href="#${collapseItem.id}"]`);
    };

    var findAllParentMenus = function (element) {
      var parentMenus = []
      var elementPointer = element;
      while (elementPointer !== document.body) {
        if (elementPointer.className.split(' ').indexOf('menu') > -1) {
          parentMenus.push(elementPointer);
        }
        elementPointer = elementPointer.parentElement;
      }
      return parentMenus;
    }

    var openMenuItem = function (element) {
      element.click();
    };

    var openAllFromList = function (elementList) {
      elementList.forEach(function (element) {
        console.log(element)
        openMenuItem(findMatchingCollapseMenu(element))
      });
    };

    var highlightAndOpenMenu = function () {
      var currentLineItem = findLineItem(document.location.pathname);
      highlighLineItem(currentLineItem)
      openAllFromList(findAllCollapseParents(currentLineItem));
    };

    $(highlightAndOpenMenu);

  }());
</script>


      </div>
      <div class="col-md-9 doc-content">
        <a class="btn btn-default btn-xs visible-xs-inline-block visible-sm-inline-block" href="/docs/toc.html">Table of Contents</a>
        <!--
    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<h2 id="frequent-items-sketches-overview">Frequent Items Sketches Overview</h2>

<p>These sketches provide the following capabilities:</p>

<ul>
  <li>
    <p>Estimate the frequency of an item.</p>
  </li>
  <li>
    <p>Return upper and lower bounds of any item, such that the true frequency is always between the upper and lower bounds.</p>
  </li>
  <li>
    <p>Return a global maximum error that holds for all items in the stream.</p>
  </li>
  <li>
    <p>Return an array of frequent items that qualify either a NO_FALSE_POSITIVES or a NO_FALSE_NEGATIVES error type.</p>
  </li>
  <li>
    <p>Merge itself with another sketch object created from the same class.</p>
  </li>
  <li>
    <p>Serialize/Deserialize to/from a byte array.</p>
  </li>
</ul>

<h3 id="two-implementations">Two Implementations</h3>

<ul>
  <li>
    <p>ItemsSketch&lt;T&gt;</p>

    <p>This sketch is useful for tracking approximate frequencies of items of type <i>&lt;T&gt;</i> 
  with optional associated counts (<i>&lt;T&gt;</i> item, <i>long</i> count) that are members of
  a multiset of such items. The true frequency of an item is defined to be the sum of associated
  counts.</p>

    <p>If the user needs to serialize and deserialize the resulting sketch for storage or transport, 
  the user must also extend the <i>ArrayOfItemsSerDe</i> interface. Two examples of 
  extending this interface are included for <i>Long</i>s and 
  <i>String</i>s: <i>ArrayOfLongsSerDe</i> and <i>ArrayOfStringsSerDe</i>.</p>
  </li>
  <li>
    <p>LongsSketch</p>

    <p>This is a custom implementation based on items of type <i>long</i>. This will perform faster and
  will have a smaller serialization footprint than the generic equivalent 
  <i>ItemsSketch&lt;Long&gt;</i>.</p>
  </li>
</ul>

<h3 id="space-usage">Space Usage</h3>

<p>The sketch is initialized with a <i>maxMapSize</i> that specifies the maximum physical 
length of the internal hash map of the form (<i>&lt;T&gt;</i> item, <i>long</i> count).
The <i>maxMapSize</i> must be a power of 2.</p>

<p>The hash map starts at a very small size (8 entries), and grows as needed up to the 
specified <i>maxMapSize</i>.</p>

<p>Excluding external space required for the item objects, the internal memory space usage of 
this sketch is 18 * <i>mapSize</i> bytes (assuming 8 bytes for each Java reference), plus a small 
constant number of additional bytes. The internal memory space usage of this sketch will never 
exceed 18 * <i>maxMapSize</i> bytes, plus a small constant number of additional bytes.</p>

<h3 id="maximum-capacity-of-the-sketch">Maximum Capacity of the Sketch</h3>

<p>The LOAD_FACTOR for the hash map is internally set at 75%, 
which means at any time the map capacity of (item, count) pairs is <i>mapCap</i> = 
0.75 * <i>&lt;mapSize</i>.
The maximum capacity of (item, count) pairs of the sketch is <i>maxMapCap</i> = 
0.75 * <i>maxMapSize</i>.</p>

<h3 id="updating-the-sketch-with-item-count-pairs">Updating the sketch with (item, count) pairs</h3>

<p>If the item is found in the hash map, the mapped count field (the “counter”) is 
incremented by the incoming count, otherwise, a new counter “(item, count) pair” is 
created. If the number of tracked counters reaches the maximum capacity of the hash map 
the sketch decrements all of the counters (by an approximately computed median), and 
removes any non-positive counters.</p>

<h3 id="accuracy-guarantees">Accuracy Guarantees</h3>

<p>If fewer than 0.75 * <i>maxMapSize</i> different items are inserted into the sketch the 
estimated frequencies returned by the sketch will be exact.</p>

<p>The logic of the frequent items sketch is such that the stored counts and true counts are 
never too different. 
More specifically, for any <i>item</i>, the sketch can return an estimate of the 
true frequency of <i>item</i>, along with upper and lower bounds on the frequency 
(that hold deterministically).</p>

<p>For this implementation and for a specific active <i>item</i>, it is guaranteed that
the true frequency will be between the Upper Bound (UB) and the Lower Bound (LB) computed for that 
<i>item</i>.  Specifically, <i>(UB- LB) ≤ W * epsilon</i>, where <i>W</i> denotes the sum of 
all item counts, and <i>epsilon = 3.5/M</i>, where <i>M</i> is the <i>maxMapSize</i>.</p>

<p>This is a worst case guarantee that applies to arbitrary inputs.<sup>1</sup> 
For inputs typically seen in practice <i>(UB-LB)</i> is usually much smaller.</p>

<p>The <a href="/docs/FrequentItems/FrequentItemsErrorTable.html">Frequent Items Error Table</a> can serve as a guide for selecting an
appropriate sized sketch for your application.</p>

<h3 id="returned-results">Returned Results</h3>

<p><b>Figure: Returned Results, Error Type and Error Bounds</b>
<img class="doc-img-full" src="/docs/img/fi/FreqItemsError3.png" alt="FreqItemsError3.png" /></p>

<p>The above figure was created with synthetic data in order to illustrate a hypothetical set of returned results with their Error Bounds and how these Error Bounds interact with the two different Error Types chosen at query time. 
The black vertical lines with end-caps represent the items with their frequencies retained by the sketch. 
The upper end-caps represents the upper bound frequencies of each item and the lower end-caps represent the lower bound frequencies of each item. 
The sketch estimate for each item will be between those values inclusively.</p>

<p>The green vertical bar on the right represents the error computed from the above error table.  It is an <i>a priori</i> error (or <i>pre-error</i>) in that it is computed before any data has been presented to the sketch.</p>

<p>The red vertical bar just to its left represents the <i>a posteriori</i> error (or <i>post-error</i>) returned by the sketch after all the data has been presented to the sketch and is often less than the pre-error. Note that the post-error is the same size as the error bounds on all the retained items in the sketch.</p>

<p>The post-error is used as a threshold by the sketch in determining which items, out of all the retained items, can be legitimately returned by the sketch.</p>

<ul>
  <li>The four items on the far right, whose lower bounds are greater than the post-error, are returned when the Error Type is set to “No False Positives”.</li>
  <li>The Seven items on the far right, whose upper bounds are greater than the post-error, are returned when the Error Type is set to “No False Negatives”.</li>
  <li>All of the remaining items, whose upper bounds are less than the post-error are never returned.</li>
</ul>

<p>In terms of order, only the first item on the far right can be safely be classified as the “most frequent” of all Items presented to the sketch. Because the upper and lower bounds of the next two items overlap, the next two to the left tie for second place. The next three to the left of those would tie for forth place, and so on.</p>

<h3 id="error-type-and-confusion-matrix">Error Type and Confusion Matrix</h3>

<p>These results can also be described using the classical “Confusion Matrix” as shown in the next figure.</p>

<p><b>Figure: Error Type and Confusion Matrix</b>
<img class="doc-img-full" src="/docs/img/fi/FI_ConfusionMatrix.png" alt="FI_ConfusionMatrix.png" /></p>

<h4 id="no-false-positives-upper-table">No False Positives (upper table)</h4>

<p>The items returned are represented by the blue “True Positive” box. 
However, there is the possibility that items, whose true frequency was above the post-error, might be excluded. 
These are the “False Negatives” represented by the red box and is classified as a “Type II Error”. 
No False Positives (Type I Error) are included. 
All True Negatives are excluded and there is no Type II Error.</p>

<h4 id="no-false-negatives-lower-table">No False Negatives (lower table)</h4>

<p>For this Error Type, all the times returned by “No False Positives” are returned in addition to items classified as “False Positives”, or Type I Error. 
All “True Negatives” are properly excluded.</p>

<h3 id="background">Background</h3>

<p>This code implements a variant of what is commonly known as the “Misra-Gries
algorithm”. Variants of it were discovered and rediscovered and redesigned several times 
over the years:</p>
<ul><li>"Finding repeated elements", Misra, Gries, 1982</li>
<li>"Frequency estimation of Internet packet streams with limited space" Demaine, 
Lopez-Ortiz, Munro, 2002</li>
<li>"A simple algorithm for finding frequent elements in streams and bags" Karp, Shenker,
Papadimitriou, 2003</li>
<li>"Efficient Computation of Frequent and Top-k Elements in Data Streams" Metwally, 
Agrawal, Abbadi, 2006</li>
</ul>

<h3 id="example-distribution-plots">Example Distribution Plots</h3>

<p>We ran two sets of experiments, the fist generated a stream from a Zipfian distribution 
with <i>alpha</i>=1.1 (high skew), and the second with a Zipfian distribution with <i>alpha</i>=0.7 
(lower skew).
The frequency of an item <i>i</i> is proportional to 1/<i>i<sup>alpha</sup></i>.</p>

<h4 id="high-skew-experiment">High Skew Experiment</h4>

<ul>
  <li>Zipfian distribution parameter <i>alpha</i> = 1.1</li>
  <li>Items generated: W = 10M</li>
  <li>Sketch parameter: maxMapSize = 2048</li>
</ul>

<p><b>Figure: Real Count Distribution 1.1</b>
<img class="doc-img-half" src="/docs/img/fi/RealCountDistribution1.1.png" alt="RealCountDistribution1.1.png" />
This is the empirical log-log distribution of the 10M random points generated.</p>

<p><b>Figure: Estimate Error 1.1</b>
<img class="doc-img-half" src="/docs/img/fi/EstimateError1.1.png" alt="EstimateError1.1.png" />
This depicts the absolute value of the error of the estimate
returned by getEstimate(item) for all items between 1 and 16000. 
Several properties are worth noting.</p>

<p>First, note the clustering of errors in the bottom left corner of the graph – 
this indicates that the estimates of the frequencies of most of the most frequent 
few hundred items are very close to exact (in fact, the maximum error for any of 
the first 189 items is just 7).</p>

<p>Second, note that, visually, two separate curves can be distinguished in the image,
with one starting from the lower left corner and increasing toward the top right corner,
and one starting from the top left corner and decreasing toward the bottom right corner.
The first curve corresponds to items that were assigned counters by the sketch at the end 
of the data stream. The estimates returned for these items are always overestimates of their
true frequencies, and these estimates tend to be more accurate for more-frequent items.</p>

<p>The second curve corresponds to items that were not assigned counters by the sketch when
the last stream update was processed. For these items, getEstimate(item) returns an estimate
of 0. Hence, the error in these estimates is exactly the true frequency of the items,
which explains why the second curve starts in the top-left corner, and heads toward
the bottom right.</p>

<p>Observe that the maximum error in the estimate of <em>any</em> item was slightly more 
than 3,000. This is much better than the “worst case error guarantee” for the sketch, 
which is W<em>(3.5)</em>(1/maxMapSize) = (10 million)<em>(3.5)</em>(1/2048) = 17,090.
This indicates that on realistic data sets, the sketch is 
significantly more accurate than the worst case error guarantee suggests.</p>

<p><b>Figure: Get Frequent Items 1.1</b>
<img class="doc-img-half" src="/docs/img/fi/GetFrequentItems1.1.png" alt="GetFrequentItems1.1.png" />
This is the log-log distribution of random points generated, color coded by whether
the points were returned by:</p>

<ul>
  <li>BLUE: Both getFrequentItems(NO_FALSE_NEGATIVES) AND getFrequentItems(NO_FALSE_POSITIVES),</li>
  <li>RED: Just getFrequentItems(NO_FALSE_NEGATIVES), or</li>
  <li>YELLOW: Neither.</li>
</ul>

<p>Recall that these functions return information about all items whose 
estimated frequencies are above the maximum error of the sketch, subject to the constraint
that either all items whose frequency <em>might</em> be above the threshold are included (NO_FALSE_NEGATIVES),
or only items whose frequency is <em>definitely</em> above the threshold are included (NO_FALSE_POSITIVES).</p>

<p>As expected, the most frequent items are returned by both function calls, while infrequent
items are returned by neither. Items in between may be returned by neither, or by
getFrequentItems(NO_FALSE_NEGATIVES) only.</p>

<p><b>Figures: LB Error 1.1 and UB Error 1.1</b>
<img class="doc-img-half" src="/docs/img/fi/LBError1.1.png" alt="LBError1.1.png" />
<img class="doc-img-half" src="/docs/img/fi/UBError1.1.png" alt="UBError1.1.png" />
The first figure depicts the error of get getLowerBound(item) for items 1, 2, …, 16000,
while the second figure depicts the error of getUpperBound(item) for the same items.</p>

<h4 id="lower-skew-experiment">Lower Skew Experiment</h4>

<ul>
  <li>Zipfian distribution parameter <i>alpha</i> = 0.7</li>
  <li>Items generated: W = 10M</li>
  <li>Sketch parameter: maxMapSize = 2048</li>
</ul>

<p><b>Figures: Real Count Distribution 0.7, Estimate Error 0.7, Get Frequent Items 0.7, LB Error 0.7 and UB Error 0.7</b></p>

<p>The following are the corresponding plots for a stream generated from a Zipfian distribution with parameter alpha=0.7. 
<img class="doc-img-half" src="/docs/img/fi/RealCountDistribution0.7.png" alt="RealCountDistribution0.7.png" />
<img class="doc-img-half" src="/docs/img/fi/EstimateError0.7.png" alt="EstimateError0.7.png" />
<img class="doc-img-half" src="/docs/img/fi/GetFrequentItems0.7.png" alt="GetFrequentItems0.7.png" />
<img class="doc-img-half" src="/docs/img/fi/LBError0.7.png" alt="LBError0.7.png" />
<img class="doc-img-half" src="/docs/img/fi/UBError0.7.png" alt="UBError0.7.png" /></p>

<p>The main takeaway from these plots relative
to the above is that the error in the estimates tend be higher than in
the case alpha=1.1. Indeed, the maximum error in any estimate is nearly twice as large
in the case alpha=0.7 than in the case alpha=1.1. Moreover, when alpha-0.7 only the estimates 
of the 6 most frequent items have error at most 10 when alpha=0.7, while in the case alpha=1.1, 
the estimates of all of the 189 most frequent items all have error at most 10.
This higher error is also manifested in the fact that getFrequentItems(NO_FALSE_POSITIVES)
only returned two items in the case alpha=0.7 (i.e., the two most frequent items in the stream),
while getFrequentItems(NO_FALSE_POSITIVES) returned 101 items in the case alpha=1.1.</p>

<p>The reason for the increased error when alpha=0.7, is that the frequency distribution is 
flatter in this case. It well-known that the algorithms we have implemented perform 
better on streams where the most frequent items make up a larger percentage of the 
stream, essentially because the sketch is able to process these items with minimal or 
no error. See, for example, “Space-optimal Heavy Hitters with Strong Error Bounds” by 
Berinde et al. for formalizations of this property.</p>

<p>Finally, observe that the maximum error in the estimate of <i>any</i> item was slightly more 
than 6,000. This is much better than the “worst case error guarantee” for the sketch, 
which is W<em>(3.5)</em>(1/maxMapSize) = (10 million)<em>(3.5)</em>(1/2048) = 17,090.
This indicates that on realistic data sets, the sketch is 
significantly more accurate than the worst case error guarantee suggests.</p>

<hr />

<p><sup>1</sup> For speed we do employ some randomization that introduces a small probability that our
proof of the worst-case bound might not apply to a given run.  However, we have ensured that 
this probability is extremely small. For example, if the stream causes one table purge (rebuild), 
our proof of the worst case bound applies with probability at least 1 - 1E-14.<br />
If the stream causes 1E9 purges, our proof applies with probability at least 1 - 1E-5.</p>


      </div>
    </div>
  </div>

  <!-- Start page_footer.html include -->
<footer class="ds-footer">
  <div class="container">
    <div class="text-center">
      <p>
        <a href="/overview.html">
          <span class="fa fa-info-circle"></span> Overview</a>&ensp;·&ensp;
        <a href="/docs/downloads.html">
          <span class="fa fa-download"></span> Download</a>&ensp;·&ensp;
        <a href="https://github.com/apache?utf8=%E2%9C%93&q=datasketches">
          <span class="fa fa-github"></span> GitHub</a>&ensp;·&ensp;
        <a href="https://groups.google.com/forum/#!forum/sketches-user">
          <span class="fa fa-comment"></span> Comments</a>&ensp;·&ensp;
        <a href="https://github.com/apache/incubator-datasketches-website/blob/asf-site/LICENSE">Licensing</a>
      </p>
    </div>
  </div>
</footer>
<!-- End page_footer.html include -->

</body>

</html>
<!-- End _layouts/doc_page.html-->
